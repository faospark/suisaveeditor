const CACHE_NAME="suikohd-editor-v1.3.2";self.addEventListener("install",(event=>{console.log("[Service Worker] Installing..."),event.waitUntil(caches.open(CACHE_NAME).then((cache=>{console.log("[Service Worker] Caching app shell");const basePath="localhost"===self.location.hostname||"127.0.0.1"===self.location.hostname?"/suisaveeditor":"",requiredFiles=[`${basePath}/`,`${basePath}/index.html`,`${basePath}/css/pico.css`,`${basePath}/src/style.css`,`${basePath}/src/main.js`,`${basePath}/src/gamedata.js`,`${basePath}/public/favicon.svg`],optionalFiles=[`${basePath}/debug/save.json`],cacheRequired=Promise.all(requiredFiles.map((url=>cache.add(url).catch((err=>{throw console.error("[Service Worker] Failed to cache required file:",url,err),err}))))),cacheOptional=Promise.all(optionalFiles.map((url=>cache.add(url).catch((err=>{console.log("[Service Worker] Optional file not cached:",url)})))));return Promise.all([cacheRequired,cacheOptional])})).then((()=>(console.log("[Service Worker] Installed successfully"),self.skipWaiting()))))})),self.addEventListener("activate",(event=>{console.log("[Service Worker] Activating..."),event.waitUntil(caches.keys().then((cacheNames=>Promise.all(cacheNames.map((cacheName=>{if(cacheName!==CACHE_NAME)return console.log("[Service Worker] Deleting old cache:",cacheName),caches.delete(cacheName)}))))).then((()=>(console.log("[Service Worker] Activated successfully"),self.clients.claim()))))})),self.addEventListener("fetch",(event=>{event.respondWith(caches.match(event.request).then((response=>{if(response)return console.log("[Service Worker] Serving from cache:",event.request.url),response;const fetchRequest=event.request.clone();return fetch(fetchRequest).then((response=>{if(!response||200!==response.status||"basic"!==response.type)return response;const responseToCache=response.clone();return caches.open(CACHE_NAME).then((cache=>{cache.put(event.request,responseToCache)})),response})).catch((()=>{console.log("[Service Worker] Network request failed for:",event.request.url)}))})))}));